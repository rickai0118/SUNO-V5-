# Suno Architect 迁移计划：从 Google Cloud Build 到本地/Web 部署

## 1. 项目现状分析

### 1.1 当前构建配置
- **构建工具**：Vite 6.2.0
- **构建命令**：
  - 开发：`npm run dev`
  - 构建：`npm run build`
  - 预览：`npm run preview`
- **依赖管理**：npm
- **CI/CD 配置**：未找到 Google Cloud Build 特定配置文件（cloudbuild.yaml）或其他 CI/CD 配置

### 1.2 核心依赖
| 依赖名称 | 版本 | 用途 |
|---------|------|------|
| react | ^19.2.0 | UI 框架 |
| react-dom | ^19.2.0 | React DOM 渲染 |
| typescript | ~5.8.2 | 类型检查 |
| vite | ^6.2.0 | 构建工具 |
| @google/genai | ^1.30.0 | Google Gemini API 客户端 |
| lucide-react | ^0.555.0 | 图标库 |

### 1.3 环境变量
- **GEMINI_API_KEY**：用于访问 Google Gemini API

## 2. 迁移计划

### 2.1 迁移目标
将项目从 Google Cloud Build 迁移到本地/Web 部署，确保：
- 保持相同的构建产物质量
- 简化部署流程
- 提高开发效率
- 降低部署成本

### 2.2 迁移步骤

#### 2.2.1 环境设置
1. **安装 Node.js**：确保本地环境安装了 Node.js 18+（推荐 Node.js 20）
2. **安装依赖**：
   ```bash
   npm install
   ```
3. **配置环境变量**：
   - 创建 `.env` 文件，添加 `GEMINI_API_KEY` 环境变量
   - 示例：
     ```
     GEMINI_API_KEY=your_api_key_here
     ```

#### 2.2.2 构建流程迁移
1. **本地构建测试**：
   ```bash
   npm run build
   ```
2. **预览构建结果**：
   ```bash
   npm run preview
   ```
3. **开发服务器测试**：
   ```bash
   npm run dev
   ```

#### 2.2.3 资源迁移
由于项目没有使用 Google Cloud 特定资源，不需要进行资源迁移。

#### 2.2.4 代码重构
项目代码没有与 Google Cloud Build 紧密耦合，不需要进行代码重构。

#### 2.2.5 自动化脚本开发
1. **添加本地构建脚本**：已在 package.json 中配置
2. **添加部署脚本**：根据目标部署平台添加相应脚本

#### 2.2.6 测试计划
1. **单元测试**：使用 Vitest 或 Jest 编写单元测试
2. **集成测试**：测试组件间的交互
3. **端到端测试**：使用 Cypress 或 Playwright 测试完整流程
4. **性能测试**：测试构建产物大小和加载性能

#### 2.2.7 文档编写
1. **更新 README.md**：添加本地部署说明
2. **编写环境配置文档**：说明如何配置环境变量
3. **编写构建指南**：详细说明构建流程

## 3. 兼容性问题及解决方案

| 问题 | 解决方案 |
|------|----------|
| Node.js 版本兼容性 | 确保使用 Node.js 18+，推荐 Node.js 20 |
| 环境变量配置 | 创建 `.env` 文件，添加必要的环境变量 |
| 构建产物大小 | 优化 Vite 配置，使用代码分割和树摇 |
| 部署平台兼容性 | 根据目标平台调整构建配置 |

## 4. 部署选项

### 4.1 本地部署
- **开发环境**：`npm run dev`
- **生产环境**：`npm run build && npm run preview`

### 4.2 Web 部署选项

#### 4.2.1 Vercel
1. 注册 Vercel 账号
2. 连接 GitHub 仓库
3. 配置环境变量
4. 自动构建部署

#### 4.2.2 Netlify
1. 注册 Netlify 账号
2. 连接 GitHub 仓库
3. 配置环境变量
4. 自动构建部署

#### 4.2.3 GitHub Pages
1. 修改 vite.config.ts，添加 base 配置
2. 添加 deploy 脚本到 package.json
3. 配置 GitHub Actions 自动部署

#### 4.2.4 自定义服务器
1. 构建项目：`npm run build`
2. 将 dist 目录部署到服务器
3. 使用 Nginx 或 Apache 配置静态文件服务

## 5. 迁移时间表

| 阶段 | 时间 | 任务 |
|------|------|------|
| 环境设置 | 1 天 | 安装依赖，配置环境变量 |
| 构建测试 | 1 天 | 测试本地构建流程 |
| 测试计划 | 2 天 | 编写测试用例，执行测试 |
| 文档编写 | 1 天 | 更新 README.md，编写部署指南 |
| 部署验证 | 1 天 | 验证不同部署平台的兼容性 |

## 6. 风险评估

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| API 密钥泄露 | 安全风险 | 使用环境变量，不在代码中硬编码 |
| 构建失败 | 部署延迟 | 编写测试用例，确保构建稳定 |
| 性能问题 | 用户体验下降 | 优化构建配置，进行性能测试 |
| 依赖冲突 | 构建失败 | 使用固定依赖版本，定期更新 |

## 7. 结论

Suno Architect 项目从 Google Cloud Build 迁移到本地/Web 部署是一个相对简单的过程，因为项目已经使用了 Vite 这样的现代构建工具，且没有与 Google Cloud Build 紧密耦合。迁移后，项目将具有更简单的部署流程、更高的开发效率和更低的部署成本。